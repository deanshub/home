- name: Get active network interface
  shell: ip route | grep default | awk '{print $5}' | head -1
  register: network_interface

- name: Configure static IP with netplan
  copy:
    dest: /etc/netplan/01-netcfg.yml
    content: |
      network:
        version: 2
        ethernets:
          {{ network_interface.stdout }}:
            dhcp4: no
            addresses: [{{ static_ip }}]
            gateway4: 192.168.31.229
            nameservers:
              addresses: [8.8.8.8,8.8.4.4]
- name: Apply netplan
  command: netplan apply
